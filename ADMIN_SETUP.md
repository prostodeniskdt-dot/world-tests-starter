# Инструкция по настройке админ-системы

## Выполненные изменения

### 1. Реструктуризация тестов
- Тесты теперь хранятся в отдельных папках: `src/tests/test-1/`, `src/tests/test-2/`, и т.д.
- Каждый тест имеет:
  - `public.ts` - публичная информация (вопросы, варианты ответов)
  - `answer.ts` - правильные ответы (только на сервере)
  - `media/` - папка для медиафайлов (видео, изображения)

### 2. Админ-система
- Добавлены поля `is_admin` и `is_banned` в таблицу `users`
- Создана админ-панель по адресу `/admin`
- Реализованы функции бана/разбана пользователей
- Забаненные пользователи не могут проходить тесты

## Что нужно сделать

### Шаг 1: Выполнить SQL миграцию

Подключитесь к PostgreSQL (Timeweb Cloud SQL-консоль, psql или pgAdmin) и выполните файл:
```
db/migrations/add-admin-fields.sql
```

Этот скрипт:
- Добавит поля `is_admin`, `is_banned`, `banned_until` в таблицу `users`
- Установит `is_admin = true` для email `prostodeniskdt@gmail.com`
- Создаст необходимые индексы

### Шаг 2: Проверить работу

1. Войдите в систему с email `prostodeniskdt@gmail.com`
2. В меню пользователя (правый верхний угол) должна появиться ссылка "Админ-панель"
3. Перейдите на `/admin` - должна открыться панель управления пользователями
4. Проверьте функции:
   - Поиск пользователей
   - Бан/разбан пользователей
   - Просмотр статистики

## Использование

### Добавление нового теста

1. Создайте папку `src/tests/test-2/` (или test-3, test-4 и т.д.)
2. Создайте файлы:
   - `public.ts` - экспортируйте `TEST_2_PUBLIC` с вопросами
   - `answer.ts` - экспортируйте `TEST_2_SECRET` с правильными ответами
   - `media/` - папка для медиафайлов (опционально)
3. Обновите `src/lib/tests-registry.ts` - добавьте импорты и в массивы `PUBLIC_TESTS` и `SECRET_TESTS`

### Бан пользователя

1. Перейдите в админ-панель `/admin`
2. Найдите пользователя через поиск
3. Нажмите "Забанить"
4. Выберите тип бана:
   - Постоянный - пользователь забанен навсегда
   - Временный - укажите дату окончания бана

### Медиафайлы в тестах

В файле `public.ts` можно указать медиафайлы для вопросов:

```typescript
{
  id: "q1",
  text: "Вопрос с изображением?",
  options: ["Вариант 1", "Вариант 2"],
  imageUrl: "/tests/test-1/media/question1.jpg", // Путь к изображению
  videoUrl: "/tests/test-1/media/question1.mp4", // Путь к видео (опционально)
}
```

Файлы размещайте в папке `src/tests/test-1/media/` и используйте относительные пути.

## Безопасность

- Админ-панель доступна только пользователям с `is_admin = true`
- Все админ-API защищены middleware проверкой прав
- Забаненные пользователи не могут:
  - Проходить тесты
  - Участвовать в рейтинге
  - Войти в систему (если бан установлен после входа, нужно перелогиниться)
